<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Garage Control</title>

    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <script src="/static/js/jquery/jquery-2.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
  </head>
  <body onload="createImageLayer()">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <h1>Garage Control</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <form action="toggle" method="post">
            <button type="submit" class="btn btn-default btn-lg">Toggle Door</button>
          </form>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-6 col-sm-4 col-md-2">
          <form action="start-camera" method="post">
            <button type="submit" class="btn btn-default btn-lg">Start Camera</button>
          </form>
        </div>
        <div class="col-xs-6 col-sm-4 col-md-2">
          <form action="stop-camera" method="post">
            <button type="submit" class="btn btn-default btn-lg">Stop Camera</button>
          </form>
        </div>
      </div>
      <div class="row">
        <div id="webcam" class="col-xs-12" style="width:640px;height:360px"><noscript><img src="/?action=snapshot" /></noscript></div>

          <script type="text/javascript">
/* Copyright (C) 2007 Richard Atterer, richard(C)atterer.net
   This program is free software; you can redistribute it and/or modify it
   under the terms of the GNU General Public License, version 2. See the file
   COPYING for details. */

var imageNr = 0; // Serial number of current image
var finished = new Array(); // References to img objects which have finished downloading
var paused = false;

function createImageLayer() {
  var img = new Image();
  img.style.position = "absolute";
  img.style.zIndex = -1;
  img.onload = imageOnload;
  img.onclick = imageOnclick;
  img.src = "https://" + window.location.hostname + ":9998" + "/?action=snapshot&n=" + (++imageNr);
  var webcam = document.getElementById("webcam");
  
  img.width = 320;
  img.height = 180;
  webcam.insertBefore(img, webcam.firstChild);
}

// Two layers are always present (except at the very beginning), to avoid flicker
function imageOnload() {
  this.style.zIndex = imageNr; // Image finished, bring to front!
  while (1 < finished.length) {
    var del = finished.shift(); // Delete old image(s) from document
    del.parentNode.removeChild(del);
  }
  finished.push(this);
  if (!paused) createImageLayer();
}

function imageOnclick() { // Clicking on the image will pause the stream
  window.open("https://" + window.location.hostname + ":9998" + "/javascript_simple.html");
}

        </script>
      </div>
    </div>
  </body>
</html>
